<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="Jquery.js"></script>
    <link rel="stylesheet" href="Datatable.css">
    <script src="DataTable.js"></script>
    <link rel="stylesheet" href="bootstrap-5.3.3-dist/css/bootstrap.css">
    <script src="bootstrap-5.3.3-dist/js/bootstrap.bundle.js"></script>

<style>
    #Popup
    {
        z-index: -1;
        opacity: 1;
        display: none;
        position: absolute;
        background-color: rgb(152, 235, 235);
        left: 20%;
        width: 70%;
        top:20%

    }
</style>
</head>

<body>
    <form id="Myform">
        <div id="Popup">
            <div class="container">
                <div class="row mb-5">
                    <div class="col-lg-4">
                        <label>FirstName</label>
                        <input type="text" name="FirstName" id="FirstName" class="form-control">
                    </div>
                    <div class="col-lg-4">
                        <label>LastName</label>
                        <input type="text" name="LastName" id="LastName" class="form-control">
                    </div>
                    <div class="col-lg-4">
                        <label>Graduation</label>
                        <input type="month" name="Graduation" id="Graduation" class="form-control">
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-4">
                        <label>DateOfbirth</label>
                        <input type="month" name="DateOfbirth" id="DateOfbirth" class="form-control">   
                    </div>
                    <div class="col-lg-4">
                        <label>Address</label>
                        <input type="text" name="Address" id="Address" class="form-control">   
                    </div>
                    <div class="col-lg-4">
                        <label>Percentage</label>
                        <input type="number" name="Percentage" id="Percentage" class="form-control">   
                    </div>
                </div>
                <div>
                    <div class="d-flex justify-content-end align-items-end mt-5">
                        <input type="button" name="add" id="add" value="add">
                    </div>
                    <table id="DynamicTable" class="table">
                            <thead>
                                    <tr>
                                        <th>Degree</th>
                                        <th>School</th>
                                        <th>StartDate</th>
                                        <th>EndDate</th>
                                        <th>Percentage</th>
                                        <th>Backlog</th>
                                        <th>Action</th>
                                    </tr>
                            </thead>    
                    </table>
                </div>
                <div class="mt-5 justify-content-end align-items-end">
                    <input type="button" name="submit" id="submit" value="submit">
                    <input type="button" name="Close" id="Close" value="Close">
                    <input type="button" name="Update" id="Update" value="Update">
                </div>
            </div>
        </div>
        <div>
            <input type="button" name="ShowPopup" id="ShowPopup" value="ShowPopup">
            
        </div>
        <div>
            <table id="OutSide">
                    <thead>
                            <tr>
                                <th>FirstName</th>
                                <th>LastName</th>
                                <th>Graduation</th>
                                <th>DateOfbirth</th>
                                <th>Address</th>
                                <th>Percentage</th>
                                <th>Action</th>
                            </tr>
                    </thead>
            </table>
        </div>
    </form>
    <script>
       
        $(document).ready(function()
        {
            var userData =[]
            var OutSide = $('#OutSide').DataTable();
            var counter=0;
            $(document).on('click','#ShowPopup',function()
            {
                $('#Popup').css({"z-index":"1","opacity":"1","display":"block"})
                $('#Myform .Dynamic').remove();
                $('#Myform .DeleteDegree').remove();
                $('#Myform')[0].reset();
            })

            $(document).on('click','#Close',function()
            {
                $('#Popup').css({"z-index":"-1","opacity":"0","display":"none"})
                $('#Myform .Dynamic').remove();
                $('#Myform .DeleteDegree').remove();
                $('#Myform')[0].reset();
            })

            $('#add').on('click',function()
            {
                
                
                var row = $('<tr>')
                    row.append('<td><input type="text" name="Degree" class="Dynamic"></td>')
                    row.append('<td><input type="text" name="School" class="Dynamic"></td>')
                    row.append('<td><input type="text" name="StartDate" class="Dynamic"></td>')
                    row.append('<td><input type="text" name="EndDate" class="Dynamic"></td>')
                    row.append('<td><input type="text" name="Percentage" class="Dynamic"></td>')
                    row.append('<td><input type="text" name="Backlog" class="Dynamic"></td>')
                    row.append('<td><input type="button" name="DeleteDegree" class="DeleteDegree" value="Delete"></td>')
                    $('#DynamicTable').append(row)
            })
            $(document).on('click','.DeleteDegree',function()
            {
                var RowClick = $(this).closest('tr').remove();
            })
            $(document).on('click','#submit',function(e)
            {
               
                e.preventDefault();
                var rowData ={}
                var FirstName = $('#FirstName').val();
                var LastName =$('#LastName').val();
                var Graduation =$('#Graduation').val();
                var DateOfbirth = $('#DateOfbirth').val();
                var Address =$('#Address').val();
                var Percentage =$('#Percentage').val();
                var DynamicAll = document.querySelectorAll('.Dynamic')
                var DynamicArray = [];
                for(var i =0;i<DynamicAll.length;i=i+6)
                {
                    
                    var DyanmicObject = {};
                    for(var j=0;j<6;j++)
                    {
                        
                        var element = DynamicAll[i+j];
                        var name = element.name;
                        var value = element.value
                        DyanmicObject[name] = value
                    }
                    DynamicArray.push(DyanmicObject)
                }
                var Object ={
                    FirstName:FirstName,
                    LastName:LastName,
                    Graduation:Graduation,
                    DateOfbirth:DateOfbirth,
                    Address:Address,
                    Percentage:Percentage,
                    DynamicArray:DynamicArray,
                    counter:counter,
                    Deleted:false
                }
                userData.push(Object)
                console.log(userData)
                counter++;
                $('#Myform .Dynamic').remove();
                $('#Myform .DeleteDegree').remove();
                $('#Myform')[0].reset();
                tableform();
            })
            function tableform()
            {
                OutSide.clear().draw();
                $.each(userData,function(index,object)
                {
                    var row = OutSide.row.add([object.FirstName,object.LastName,object.Graduation,object.DateOfbirth,object.Address,object.Percentage,'<input type="button" name="edit" value="edit" class="edit"><input type="button" name="deleteOutside" value="deleteOutside" class="deleteOutside"><input type="button" name="showTable" value= "showTable" class="showTable">']).draw().node();
                    $(row).attr('counter',object.counter);
                })
            }
            $(document).on('click','.edit',function()
            {
                var ClickWhere = $(this).closest('tr').attr('counter')
                var FindClickIndex = userData.findIndex(function(element)
                {
                    return element.counter == ClickWhere
                })
                console.log(FindClickIndex)
                var Object = userData[FindClickIndex]
                var DynamicClickCount = userData[FindClickIndex].DynamicArray

                $('#ShowPopup').click();
                for(var i=0;i<DynamicClickCount.length;i++)
                {
                    $('#add').click();
                }
                debugger
                var DynamicAll = document.querySelectorAll('.Dynamic')

                
                DynamicAll.forEach(function(element,index)
                {
                    var name = element.name;
                    var value = DynamicClickCount[Math.floor(index/6)][name]
                    element.value = value
                })
                $('#FirstName').val(Object.FirstName)
                $('#LastName').val(Object.LastName)
                $('#Graduation').val(Object.Graduation)
                $('#DateOfbirth').val(Object.DateOfbirth)
                $('#Address').val(Object.Address)
                $('#Percentage').val(Object.Percentage)

                $(document).on('click','#Update',function()
                {
                    var NewObject = {}
                    var counter = userData[FindClickIndex].counter
                    var Deleted = userData[FindClickIndex].Deleted
                    var FirstName = $('#FirstName').val()
                    LastName = $('#LastName').val();
                    Graduation = $('#Graduation').val();
                    DateOfbirth = $('#DateOfbirth').val();
                    Address = $('#Address').val();
                    Percentage = $('#Percentage').val();
                    var NewDynamicArray =[]
                    var DynamicCount = document.querySelectorAll('.Dynamic')
                    for(var i=0;i<DynamicCount.length;i=i+6)
                    {
                        var NewDyanmicObject = {}

                        for(var j=0;j<6;j++)
                        {
                            var element = DynamicCount[i+j]
                            var name = element.name;
                            var value = element.value;
                            NewDyanmicObject[name] = value
                        }
                        NewDynamicArray.push(NewDyanmicObject)
                    }
                    NewObject ={
                        FirstName:FirstName,
                        LastName:LastName,
                        Graduation:Graduation,
                        DateOfbirth:DateOfbirth,
                        Address:Address,
                        Percentage:Percentage,
                        DynamicArray:NewDynamicArray,
                        counter:counter,
                        Deleted:Deleted
                    }
                    userData[FindClickIndex] = NewObject;
                    tableform();
                }) // update 
            }) // edit 

            $(document).on('click','.showTable',function()
            {
                var RowClick = $(this).closest('tr').attr('counter')
                var Rows = $(this).closest('tr')
                var FindIndexOfClick = userData.findIndex(function(element)
                {
                    return element.counter == RowClick
                })

                var ArrayOfData = userData[FindIndexOfClick].DynamicArray

                var table = $('<table>');
                    Rows.after(table)
                
                var datatable = table.DataTable({
                    
                    paging:false,
                    info:false,
                    searching:false,
                    data:ArrayOfData,
                    columns:[
                        {data:"Degree",title:"Degree"},
                        {data:"School",title:"School"},
                        {data:"StartDate",title:"StartDate"},
                        {data:"EndDate",title:"EndDate"},
                        {data:"Percentage",title:"Percentage"},
                        {data:"Backlog",title:"Backlog"},
                    ]
                })
            })
        })
    </script>
</body>

</html>

