<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.0/css/dataTables.dataTables.css" />
    <script src="https://cdn.datatables.net/2.0.0/js/dataTables.js"></script>
    <style>
        #popup {
            position: absolute;
            display: none;
            z-index: -1;
            opacity: 1;
            left: 20%;
            background-color: aqua;
        }
    </style>

</head>

<body>
    <form id="myform">
        <input type="button" name="showPopup" id="showPopup" value="showPopup">
        <div id="popup">
            <div class="container">
                <div class="row mb-5">
                    <div class="col-lg-4">
                        <label>CategoryItem</label>
                        <input type="text" name="CategoryItem" id="CategoryItem" class="form-control">
                    </div>
                    <div class="col-lg-4">
                        <label>Category_Description</label>
                        <input type="text" name="Category_Description" id="Category_Description" class="form-control">
                    </div>
                    <div class="col-lg-4">
                        <label>Active</label>
                        <input type="checkbox" name="ActiveOutside" id="Active" checked>
                    </div>
                </div>
                <div class="row mb-5">
                    <div class="col-lg-6">
                        <label>LaunchDate</label>
                        <input type="date" name="LaunchDate" id="LaunchDate" class="form-control">
                    </div>
                    <div class="col-lg-6">
                        <input type="button" name="ADDItem" id="ADDItem" value="ADDItem" class="btn btn-primary">
                    </div>

                </div>
                <table id="Abhishek">
                    <thead>
                        <tr>
                            <th>itemName</th>
                            <th>itemDescription</th>
                            <th>ItemSelect </th>
                            <th>Discount</th>
                            <th>GST</th>
                            <th>Price</th>
                            <th>Active</th>
                        </tr>
                    </thead>
                </table>
            </div>
            <div>
                <input type="button" name="Save" id="Save" value="Save">
                <input type="button" name="Update" id="Update" value="Update">
                <input type="button" name="Close" id="Close" value="Close">

            </div>
            <div>
                <input type="text" name="discountedPrice" id="discountedPrice" value="0">
            </div>
        </div>
        <div>
            <table id="OutsideTable">
                <thead>
                    <tr>
                        <th>CategoryItem</th>
                        <th>Category_Description</th>
                        <th>Active</th>
                        <th>LaunchValues</th>
                        <th>Action</th>
                    </tr>
                </thead>
            </table>
        </div>
    </form>
    <script>
        var b = ['veg', 'non_veg', 'food', 'seafood']
        var TableOutside = $('#OutsideTable').DataTable();
        var counter = 0;

        var userData = []
        function abhishek() {
            var a = '<select id="Selection" name="Selection" class="Dynamic">'
            b.forEach(function (element) {
                var options = '<option name="' + element + '" value="' + element + '">' + element + '</option>'
                a += options
            })
            a += '</select>'

            return a
        }
        function maximumDate() {
            var a = new Date()
            return a;
        }
        function SettingValues(element) {
            
            var element = element;
            if (element.checked) {
                $(element).attr("value", "true");
            }
            else {
                $(element).attr("value", "false")
            }
        }
        function format(d) {
            return (
                '<dl>' +
                '<dt>Full name:</dt>' +
                '<dd>' +
                d.CategoryItem +
                '</dd>'
            );


        }
        function Calculation(element) {
            debugger
            var a = element;
            var discountedPrice = parseInt($('#discountedPrice').val());
            var row = $(element).closest('tr')
            var td1 = row.find('td').eq(0).find('input').val(); //itemname
            var td2 = row.find('td').eq(1).find('input').val(); //description 
            var td3 = row.find('td').eq(2).find('select').val(); //item 
            var td4 = parseInt(row.find('td').eq(3).find('input').val()); //discount
            var td5 = parseInt(row.find('td').eq(4).find('input').val()); //gst
            var td6 = parseInt(row.find('td').eq(5).find('input').val()); //price
            var td7 = parseInt(row.find('td').eq(6).find('input').val()); // checkbox

            var td8 = td6 + td5
            discountedPrice += td8 - td4
            console.log(td1, td2, td3, td4, td5, td6, td7);
            $('#discountedPrice').val(discountedPrice)
            row.find('td').eq(7).find('input').val(discountedPrice)
        }
        $(document).ready(function (e) {
            $(document).on('click', '#showPopup', function () {
                $('#popup').css({ "display": "block", "z-index": "1", "opacity": "1" })
                $('#myform')[0].reset();
                $('#myform .Dynamic').remove();
                $('#myform .DynamicDelete').remove();

            })

            $(document).on('click', '#Close', function () {
                $('#popup').css({ "display": "none", "z-index": "-1", "opacity": "0" })
                $('#myform')[0].reset();
                $('#myform .Dynamic').remove();
                $('#myform .DynamicDelete').remove();
            })
            $(document).on('click', '#ADDItem', function () {
                var row = $('<tr>')
                row.append('<td><input type="text" name="itemName" id="itemName" class="Dynamic"></td> ')
                row.append('<td><input type="text" name="itemDescription" id="itemDescription"class="Dynamic"></td>')
                row.append('<td>' + abhishek() + '</td>')
                row.append('<td><input type="number" name="Price" id="Price" class="Dynamic"></td>')
                row.append('<td><input type="number" name="Discount" id="Discount" class="Dynamic"></td>')
                row.append('<td><input type="number" name="GST" id="GST" class="Dynamic" onchange=Calculation(this)></td>')
                row.append('<td><input type="checkbox" name="Active" id="Active" class="Dynamic" onblur="SettingValues(this)"></td>')
                row.append('<td><input type="text" name="DiscountPrice" id="DiscountPrice" class="Dynamic" hidden></td>')
                row.append('<td ><input type="button" value="Delete" class="DynamicDelete" ></td>');

                $('#Abhishek').append(row)

            })
            $(document).on('click', '#Save', function (e) {
                var rowData = {};
                e.preventDefault();
                var CategoryItem = $('#CategoryItem').val();
                var Category_Description = $('#Category_Description').val();
                var Active = $('#Active').val();
                var LaunchDate = $('#LaunchDate').val();
                debugger
                var Date1 = new Date(LaunchDate)
                var PrsentDate = new Date();
                var ThirdDate = parseInt(PrsentDate - Date1)
                var fouthDate = ThirdDate / (1000 * 60 * 60 * 24)
                if (fouthDate < 7) {
                    var Value = "new"
                }
                else {
                    var Value = "Old"
                }
                var dynamic = document.querySelectorAll('.Dynamic')
                var dynamicArray = []
                for (var i = 0; i < dynamic.length; i = i + 8) {

                    var DynamicObject = {};
                    for (var j = 0; j < 8; j++) {
                        debugger
                        var element = dynamic[i + j]
                        var name = element.name;
                        var value = element.value;
                        DynamicObject[name] = value
                    }
                    dynamicArray.push(DynamicObject)
                }
                debugger
                var a = document.querySelectorAll('input[name ="ActiveOutside"]:checked')
                if (a.length > 0) {
                    debugger

                    var activeStatus = "Yes"
                }
                else {
                    var activeStatus = "No"
                }
                var Discountedprice = $('#discountedPrice').val();
                rowData = {
                    CategoryItem: CategoryItem,
                    Category_Description: Category_Description,
                    activeStatus: activeStatus,
                    LaunchDate: LaunchDate,
                    dynamicArray: dynamicArray,
                    counter: counter,
                    LaunchValue: Value,
                    Deleted: false,
                    Discountedprice: Discountedprice

                }
                userData.push(rowData)
                console.log(userData)
                counter++;
                TableForm()
                $('#myform')[0].reset();
                $('#myform .Dynamic').remove();
                $('#myform .DynamicDelete').remove();
            })
            function TableForm() {
                TableOutside.clear().draw();
                $.each(userData, function (index, object) {
                    var row = TableOutside.row.add([object.CategoryItem, object.Category_Description, object.activeStatus, object.LaunchValue, '<input type="button" name="Edit" class="Edit" value="Edit"><input type="button" name="Delete" class="Delete" value="Delete"><input type="button" value="showDataTable" class="showDataTable">']).draw().node();
                    $(row).attr('counter', object.counter)
                })
            }
            $(document).on('click', '.Edit', function () {
                var rowClick = $(this).closest('tr').attr('counter')
                var rowFindex = userData.findIndex(function (element) {
                    return element.counter == rowClick
                })
                var a = userData[rowFindex]
                $('#showPopup').click();
                $('#CategoryItem').val(userData[rowFindex].CategoryItem)
                $('#Category_Description').val(userData[rowFindex].Category_Description)
                if (userData[rowFindex].activeStatus == 'Yes') {
                    $('input[name="ActiveOutside"]').prop('checked', true);
                }
                else {
                    $('input[name="ActiveOutside"]').prop('checked', false);
                }
                $('#LaunchDate').val(userData[rowFindex].LaunchDate)
                var DynamicAll = userData[rowFindex].dynamicArray;
                for (var i = 0; i < DynamicAll.length; i++) {
                    $('#ADDItem').click();
                }
                var DynamicAdded = document.querySelectorAll('.Dynamic')
                DynamicAdded.forEach(function (element, index) {
                    debugger
                    var element = element
                    var name = element.name;
                    var value = DynamicAll[Math.floor(index / 8)][name]
                    if (name == 'Active' && value == "true") {
                        element.checked = true;
                    }
                    else {
                        element.checked = false;
                    }
                    element.value = value;
                })
            })
            $(document).on('click', '.showDataTable', function () {
                debugger;
                var rowClick = $(this).closest('tr').attr('counter');
                var row = $(this).closest('tr');
                var rowFindex = userData.findIndex(function (element) {
                    return element.counter == rowClick;
                });
                var a = userData[rowFindex].dynamicArray;
                console.log(a);

                // Create the table with thead and tbody
                var table = $('<table><thead><tr><th>Number</th><th>DiscountPrice</th><th>Action</th></tr></thead><tbody></tbody><tfoot><tr><th>Total</th><th></th></tr></tfoot></table>');
                row.after(table);

                var dataTable = table.DataTable({
                    paging: false,
                    searching: false,
                    info: false})
                var counter5=1 
                $.each(a,function(index,object)
                {
                    var row = dataTable.row.add([counter5,object.Active,'<input type="button" value="EditItem" class="EditItem">']).draw().node()
                    $(row).attr('counter5',counter5)
                    counter5++;
                })
                $(document).on('click','.EditItem',function()
                {
                    debugger
                    var rowWasclick = $(this).closest('tr').attr('counter5')
                    var newIndex = rowWasclick-1;
                    var newData = a[newIndex];
                    console.log(newIndex)
                    
                })

                
            });
           


        })
    </script>
</body>

</html>