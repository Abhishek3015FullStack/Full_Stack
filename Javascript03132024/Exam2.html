<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.0/css/dataTables.dataTables.css" />
    <script src="https://cdn.datatables.net/2.0.0/js/dataTables.js"></script>
    <style>
        .error-message {
            color: red;
            font-size: 12px;
        }

        #popup {
            position: absolute;
            z-index: -1;
            opacity: 0;
            display: none;
            background-color: aqua;
            left: 20%;
            top: 20%;
        }

        .dynamic1 {
            margin: 2px;
        }
    </style>
</head>

<body>
    <form id="myform">
        <div>
            <input type="button" id="showPopup" value="showPopup">
        </div>
        <div id="popup">
            <label>FirstName</label>
            <input type="text" name="FirstName" id="FirstName">
            <input type="button" name="AddDynamic" id="AddDynamic" value="AddDynamic">
            <table id="MyTable">
                <thead>
                    <tr>
                        <th>Degree</th>
                        <th>School</th>
                        <th>StartDate</th>
                        <th>EndDate</th>
                        <th>Percentage</th>
                        <th>BackLog</th>
                        <th>Action</th>
                    </tr>
                </thead>
            </table>
            <input type="button" name="submit" id="submit" value="submit">
            <input type="button" name="close" id="close" value="close">
            <div class="mt-5">

                <input type="text" name="totalOFDegree" id="totalOFDegree">
                <input type="text" name="totalOFSchool" id="totalOFSchool">
                <input type="text" name="totalOFStartDate" id="totalOFStartDate">
                <input type="text" name="totalOFEndDate" id="totalOFEndDate">
                <input type="text" name="totalOFPercentage" id="totalOFPercentage">
                <input type="text" name="totalOFBackLog" id="totalOFBackLog">

            </div>
        </div>
        <div>
            <table id="OusideTable">
                <thead>
                    <tr>
                        <th>FirstName</th>
                        <th>Action</th>
                    </tr>
                </thead>
            </table>
        </div>
    </form>

    <script>
        var userData = []
        var counter = 0;
        var counter1 = 0
        var totalTd1 = 0;
        var totalTd2 = 0;
        var totalTd3 = 0;
        var totalTd4 = 0;
        var totalTd5 = 0;
        var totalTd6 = 0;
        var OusideTable = $('#OusideTable').DataTable();
        function abhishek(element) {
            debugger
            var td7 = 0
            var row = $(element).closest('tr');
            var td1 = parseInt(row.find('td').eq(0).find('input').val());
            var td2 = parseInt(row.find('td').eq(1).find('input').val());
            var td3 = parseInt(row.find('td').eq(2).find('input').val());
            var td4 = parseInt(row.find('td').eq(3).find('input').val());
            var td5 = parseInt(row.find('td').eq(4).find('input').val());
            var td6 = parseInt(row.find('td').eq(5).find('input').val());
            td7 = td1 + td2 + td3 + td4 + td5 + td6 + td7
            row.find('td').eq(7).find('input').val(td7)

            if (td1 > 0) {
                totalTd1 += td1;
                $('#totalOFDegree').val(totalTd1)
            }
            if (td2 > 0) {
                totalTd2 += td2
                $('#totalOFSchool').val(totalTd2)
            }
            if (td3 > 0) {
                totalTd3 += td3
                $('#totalOFStartDate').val(totalTd3)
            }
            if (td4 > 0) {
                totalTd4 += td4
                $('#totalOFEndDate').val(totalTd4)
            }
            if (td5 > 0) {
                totalTd5 += td5
                $('#totalOFPercentage').val(totalTd5)
            }
            if (td6 > 0) {
                totalTd6 += td6
                $('#totalOFBackLog').val(totalTd6)
            }

        }

        $(document).on('click', '#AddDynamic', function () {
            var row = $('<tr>');
            row.append('<td><input type="number" class="degree dynamic" name="Degree" id="DegreeField' + counter + '" ><br> <span class="degree-error error-message " id="DegreeField' + counter + 'Span"></span></td>');
            row.append('<td><input type="number" class="school dynamic" name="School" id="schoolField' + counter + '"><br><span class="school-error error-message " id="schoolField' + counter + 'Span"></span></td>');
            row.append('<td><input type="number" class="startDate dynamic" name="StartDate" id="startDateField' + counter + '" ><br><span class="startDate-error error-message " id="startDateField' + counter + 'Span"></span></td>');
            row.append('<td><input type="number" class="endDate dynamic" name="EndDate" id="EndDateField' + counter + '" ><br><span class="endDate-error error-message " id="EndDateField' + counter + 'Span"></span></td>');
            row.append('<td><input type="number" class="percentage dynamic" name="Percentage" id="percentageField' + counter + '" ><br><span class="percentage-error error-message " id="percentageField' + counter + 'Span"></span></td>');
            row.append('<td><input type="number" class="backLog dynamic" name="BackLog" id="BackLogField' + counter + '" onblur = abhishek(this)><br><span class="backLog-error error-message " id="BackLogField' + counter + 'Span"></span></td>');
            counter++;
            row.append('<td><input type="button" value="Delete" class="Delete "></td>');
            row.append('<td><input type="text" class="dynamic" name ="TotalCalCulation"></td>')
            $('#MyTable').append(row);
        });
        $('#showPopup').on('click', function () {
            $('#popup').css({ "z-index": "1", "opacity": "1", "display": "block" })
            $('#AddDynamic').click();

        })
        $('#close').on('click', function () {
            $('#popup').css({ "z-index": "-1", "opacity": "0", "display": "none" })
            $('.dynamic').remove();
        })
        $(document).on('click', '#submit', function (e) {
            var total = 0
            var rowData = {}
            var TotalDegree = 0
            var TotalSchool = 0;
            var TotalStartDate = 0;
            var TotalEndDate = 0;
            var Percentage = 0;
            var BackLog = 0;
            var TotalCalCulation = 0;
            e.preventDefault();
            var DynamicFields = document.querySelectorAll('.dynamic')
            var DynamicArray = [];
            for (var i = 0; i < DynamicFields.length; i = i + 7) {
                var DyanmicObject = {}
                for (var j = 0; j < 7; j++) {
                    debugger
                    var element = DynamicFields[i + j];
                    var name = element.name;
                    var value = element.value;
                    DyanmicObject[name] = value
                    if (name == "Degree") {
                        TotalDegree += parseInt(value)
                    }
                    if (name == "School") {
                        TotalSchool += parseInt(value)
                    }
                    if (name == "StartDate") {
                        TotalStartDate += parseInt(value)
                    }
                    if (name == "EndDate") {
                        TotalEndDate += parseInt(value)
                    }
                    if (name == "Percentage") {
                        Percentage += parseInt(value)
                    }
                    if (name == "BackLog") {
                        BackLog += parseInt(value)
                    }
                    if (name == "TotalCalCulation") {
                        TotalCalCulation += parseInt(value)
                    }
                }
                DynamicArray.push(DyanmicObject)
            }
            var FirstName = $('#FirstName').val();

            rowData = {
                FirstName: FirstName,
                DynamicArray: DynamicArray,
                TotalDegree: TotalDegree,
                TotalSchool: TotalSchool,
                TotalStartDate: TotalStartDate,
                TotalEndDate: TotalEndDate,
                Percentage: Percentage,
                BackLog: BackLog,
                TotalCalCulation: TotalCalCulation,
                counter1: counter1,

            }
            userData.push(rowData)
            console.log(userData)
            TableForm()
            $('#close').click();
            $('.dynamic').remove();


        })
        function TableForm() {
            OusideTable.clear().draw();
            $.each(userData, function (index, object) {
                var row = OusideTable.row.add([object.FirstName, '<input type="button" name="edit" class="edit" value="edit"><input type="button" name="Delete" class="Delete" value="Delete"><input type="button" name="ShowTable" class="ShowTable" value="ShowTable"> ']).draw().node();
                $(row).attr('counter1', object.counter1);
            })
        }
        $(document).on('click', '.edit', function () {
            var rowClick = $(this).closest('tr').attr('counter1')
            var rowIndex = userData.findIndex(function (element) {
                return element.counter1 == rowClick
            })

        })
        $(document).on('click', '.ShowTable', function () {
            var rowClick = $(this).closest('tr').attr('counter1')
            var rowIndex = userData.findIndex(function (element) {
                return element.counter1 == rowClick
            })
            var row = $(this).closest('tr')
            var a = userData[rowIndex].DynamicArray
            
            var table = $('<table><thead><tr><th>Degree</th><th>School</th><th>StartDate</th><th>EndDate</th><th>Percentage</th><th>BackLog</th></tr></thead><tfoot><tr><th>'+userData[rowIndex].TotalDegree +'</th><th>'+userData[rowIndex].TotalSchool +'</th><th>'+ userData[rowIndex].TotalStartDate+'</th><th>'+ userData[rowIndex].TotalEndDate+'</th><th>'+ userData[rowIndex].Percentage+'</th><th>'+userData[rowIndex].BackLog +'</th></tr></tfoot></table>')
            row.after(table)
            var dataTable = table.dataTable({
                searching:false,
                info:false,
                paging:false,
                data:a,
                columns:[
                    {data:"Degree"},
                    {data:"School"},
                    {data:"StartDate"},
                    {data:"EndDate"},
                    {data:"Percentage"},
                    {data:"BackLog"}
                ],
                footer:true
            })

        })

    </script>
</body>

</html>