<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.0/css/dataTables.dataTables.css" />
    <script src="https://cdn.datatables.net/2.0.0/js/dataTables.js"></script>
    <style>
        .error-message {
            color: red;
            font-size: 12px;
        }
        #popup
        {
            position: absolute;
            z-index: -1;
            opacity: 0;
            display: none;
            background-color: aqua;
            left: 20%;
            top: 20%;
        }
        .dynamic
        {
            margin: 2px;
        }
    </style>
</head>

<body>
    <form id="myform">
        <div>
            <input type="button" id="showPopup" value="showPopup" >
        </div>
        <div id="popup">
            <input type="button" name="AddDynamic" id="AddDynamic" value="AddDynamic">
            <table id="MyTable">
                <thead>
                    <tr>
                        <th>Degree</th>
                        <th>School</th>
                        <th>StartDate</th>
                        <th>EndDate</th>
                        <th>Percentage</th>
                        <th>BackLog</th>
                        <th>Action</th>
                    </tr>
                </thead>
            </table>
            <input type="button" name="submit" id="submit" value="submit">
            <input type="button" name="close" id="close" value="close">
            <div class="mt-5">
                
                <input type="text" name="totalOFDegree" id="totalOFDegree">
                <input type="text" name="totalOFSchool" id="totalOFSchool">
                <input type="text" name="totalOFStartDate" id="totalOFStartDate">
                <input type="text" name="totalOFEndDate" id="totalOFEndDate">
                <input type="text" name="totalOFPercentage" id="totalOFPercentage">
                <input type="text" name="totalOFBackLog" id="totalOFBackLog">
                <input type="text" name="totalOFBackLog" id="totalOFBackLog">
            </div>
        </div>
    </form>
    <script>
        var userData =[]
        var counter = 0;
        function abhishek(element) {
            debugger
            var td7 =0
            var row = $(element).closest('tr');
            var td1 = parseInt(row.find('td').eq(0).find('input').val());
            var td2 = parseInt(row.find('td').eq(1).find('input').val());
            var td3 = parseInt(row.find('td').eq(2).find('input').val());
            var td4 = parseInt(row.find('td').eq(3).find('input').val());
            var td5 = parseInt(row.find('td').eq(4).find('input').val());
            var td6 = parseInt(row.find('td').eq(5).find('input').val());
            td7 = td1+td2+td3+td4+td5+td6+td7
            row.find('td').eq(7).find('input').val(td7)
        }

        $(document).on('click', '#AddDynamic', function () {
            var row = $('<tr>');
            row.append('<td><input type="number" class="degree dynamic" name="Degree" id="DegreeField' + counter + '" ><br> <span class="degree-error error-message" id="DegreeField' + counter + 'Span"></span></td>');
            row.append('<td><input type="number" class="school dynamic" name="School" id="schoolField' + counter + '"><br><span class="school-error error-message" id="schoolField' + counter + 'Span"></span></td>');
            row.append('<td><input type="number" class="startDate dynamic" name="StartDate" id="startDateField' + counter + '" ><br><span class="startDate-error error-message" id="startDateField' + counter + 'Span"></span></td>');
            row.append('<td><input type="number" class="endDate dynamic" name="EndDate" id="EndDateField' + counter + '" ><br><span class="endDate-error error-message" id="EndDateField' + counter + 'Span"></span></td>');
            row.append('<td><input type="number" class="percentage dynamic" name="Percentage" id="percentageField' + counter + '" ><br><span class="percentage-error error-message" id="percentageField' + counter + 'Span"></span></td>');
            row.append('<td><input type="number" class="backLog dynamic" name="BackLog" id="BackLogField' + counter + '" onblur = abhishek(this)><br><span class="backLog-error error-message" id="BackLogField' + counter + 'Span"></span></td>');
            counter++;
            row.append('<td><input type="button" value="Delete" class="Delete"></td>');
            row.append('<td><input type="text" class="dynamic" name ="TotalCalCulation"></td>')
            $('#MyTable').append(row);
        });
        $('#showPopup').on('click',function()
        {   
            $('#popup').css({"z-index":"1","opacity":"1","display":"block"})
            $('#AddDynamic').click();
        })
        $('#close').on('click',function()
        {
            $('#popup').css({"z-index":"-1","opacity":"0","display":"none"})  
        })
        $(document).on('click','#submit',function(e)
        {  
            var total =0
            var rowData ={} 
            e.preventDefault();
            var DynamicFields = document.querySelectorAll('.dynamic')
            var DynamicArray =[];
            for(var i=0;i<DynamicFields.length;i=i+7)
            {
                var DyanmicObject ={}
                for(var j=0;j<7;j++)
                {
                    debugger
                    var element = DynamicFields[i+j];
                    var name = element.name;
                    var value = element.value;
                    DyanmicObject[name] =value
                }
                DynamicArray.push(DyanmicObject)
            }
        
            rowData ={
                DynamicArray:DynamicArray
            }
            userData.push(DynamicArray)
            console.log(userData)
            console.log(total)
            var a = userData[0].DynamicArray ;
            console.log(a)
        })
    </script>
</body>

</html>