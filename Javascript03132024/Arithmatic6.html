<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.0/css/dataTables.dataTables.css" />
    <script src="https://cdn.datatables.net/2.0.0/js/dataTables.js"></script>
</head>

<body>
    <form id="myform">
        <input type="text" name="firstName" id="firstName">
        <input type="button" name="Dynamic" id="Dynamic" value="Dynamic">
        <input type="button" name="Save" id="Save" value="Save">
        <table id="Degree">
            <thead>
                <tr>
                    <th>Degree</th>
                    <th>School</th>
                    <th>StartDate</th>
                    <th>Passout_Year</th>
                    <th>Percentage</th>
                    <th>Backlog</th>
                </tr>
            </thead>
        </table>
        <h4>Outside Table</h4>
        <table id="outsideTable">
            <thead>
                <tr>
                    <th>FirstName</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>

    </form>
    <script>
        var userData = [];
        var counter1 = 0;
        var counter =0;
        var outsideTable = $('#outsideTable').DataTable(); 
        $(document).ready(function () {
            $(document).on('click', '#Save', function (e) {
                var RowData = {};
                e.preventDefault();
                var FirstName = $('#firstName').val();
                RowData['FirstName'] = FirstName
                var dynamicFields = document.querySelectorAll('.Dynamic')
                var DynamicFieldsArray =[]
                for(var i = 0;i<dynamicFields.length;i=i+6)
                {debugger
                    var Object ={}
                    for(var j=0;j<6;j++)
                    {
                        debugger
                        var element = dynamicFields[i+j] ;
                        var id = element.id;
                        var value = element.value
                        Object[id] = value;
                        
                    }
                    DynamicFieldsArray.push(Object)
                }
                RowData['DynamicFieldsArray']= DynamicFieldsArray
                RowData['counter']= counter;
                userData.push(RowData)
                console.log(userData)
                counter1 = 0;
                $('#myform .Dynamic').remove();
                table();
            })
            $('#Dynamic').on('click', function () {
                var row = $('<tr>')
                row.append('<td><input type="text" name="Degree" id="Degree' + counter1 + '" class="Dynamic"></td>');
                row.append('<td><input type="text" name="School" id="School' + counter1 + '" class="Dynamic"></td>');
                row.append('<td><input type="text" name="Start_date" id="Start_date' + counter1 + '" class="Dynamic"></td>');
                row.append('<td><input type="text" name="End_date" id="End_date' + counter1 + '" class="Dynamic"></td>');
                row.append('<td><input type="text" name="Percentage" id="Percentage' + counter1 + '" class="Dynamic"></td>');
                row.append('<td><input type="text" name="Backlog" id="Backlog' + counter1 + '" class="Dynamic"></td>');
                $('#Degree').append(row)
                counter1++;


            })
            function table()
            {
                outsideTable.clear().draw();
                $.each(userData,function(index,object)
                {
                    var row = outsideTable.row.add([object.FirstName,'<input type="button" name="edit" class="edit" value="edit"><input type="button" name="showTable" class="showTable" value="showTable">']).draw().node()
                    $(row).attr('counter',object.counter)
                })  
            }
            $(document).on('click','.edit',function()
            {
                var ClickOnEdit =$(this).closest('tr').attr('counter')
                var FindIndexArra = userData.findIndex(function(element)
                {
                    return element.counter == ClickOnEdit
                })
                var Object = userData[FindIndexArra]
                var DynamicObjectSize = userData[FindIndexArra].DynamicFieldsArray
                var actualSize = DynamicObjectSize.length/6;
                for(var i=0;i<DynamicObjectSize.length;i++)
                {
                    $('#Dynamic').click();
                }
                var dynamicCollection = document.querySelectorAll('.Dynamic')
                dynamicCollection.forEach(function(element)
                {
                    var id = element.id;
                    var value = DynamicObjectSize.find(function(item)
                    {
                        return item.hasOwnProperty(id)
                    })[id]
                    element.value = value
                })

            })
            $(document).on('click', '.showTable',function()
            {
                debugger
                var RowClick = $(this).closest('tr').attr('counter')
                var append1 = $(this).closest('tr')
                var FindIndex1 = userData.findIndex(function(element)
            
                {
                    return element.counter == RowClick
                }) 
                var Object = userData[FindIndex1];
                var ActualDynamicData = userData[FindIndex1].DynamicFieldsArray
                var i=0;
                var NewArray = ActualDynamicData.map(item=>
                {
                    var newObject ={
                        Degree:item["Degree"+i],
                        School:item["School"+i],
                        Start_date:item["Start_date"+i],
                        End_date:item["End_date"+i],
                        Percentage:item["Percentage"+i],
                        Backlog:item["Backlog"+i],

                    }
                    i++;
                    return newObject;
                })
                console.log(NewArray)
                var table1 = $('<table>').attr({"id":"Mytable"});
                    append1.after(table1)
                var dataTable = table1.DataTable({
                    paging:false,
                    info:false,
                    searching:false,
                    data:NewArray,
                    columns:[
                        {data:"Degree",title:"Degree"},
                        {data:"School",title:"School"},
                        {data:"Start_date",title:"Startdate"},
                        {data:"End_date",title:"Passout_Year"},
                        {data:"Percentage",title:"Percentage"},
                        {data:"Backlog",title:"Backlog"},
                    ]
                })
            })
        })

    </script>
</body>

</html>