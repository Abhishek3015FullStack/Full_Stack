<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.0/css/dataTables.dataTables.css" />
    <script src="https://cdn.datatables.net/2.0.0/js/dataTables.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.0/css/dataTables.dataTables.css" />
    <script src="https://cdn.datatables.net/2.0.0/js/dataTables.js"></script>
    <style>
        #showData {
            height: 500px;
            width: 500px;
            background-color: white;
            border: 2px solid black;
            display: none;
        }
    </style>
</head>

<body>
    <form id="MyForm">
        <input type="button" name="addButton" value="Add Button" id="addButton">
        <input type="text" name="Firstname" id="Firstname">
        <input type="submit" name="submit" id="submit" value="submit">
        <!-- <input type="button" name="showData" id="ShowAll" value="ShowAll"> -->
        <input type="button" name="update" id="update" value="update">
        <table>
            <thead>
                <tr>
                    <th>Degree</th>
                    <th>School</th>
                    <th>10</th>
                    <th>12</th>
                    <th>13</th>
                    <th>14</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="Tbody"></tbody>
        </table>
        <table id="SecondTable">
            <thead>
                <tr>
                    <th>Firstname </th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </form>
    <script>
        var Counter = 0;
        var allData = [];
        var Counter1 = 0;
        var RowIndex1s;
        $(document).ready(function () {
            $('#addButton').on('click', function () {
                var newRow = '<tr>'
                for (var i = 0; i < 6; i++) {
                    newRow += ('<td> <input type="text" class="dynamic" id="dynamic' + Counter + '"></td> delete button for the row ');
                    Counter++;
                }
                newRow += '<td><button class="delete">Delete</button></td>';
                newRow += '</tr>'
                $('#Tbody').append(newRow);
            })

            $('#MyForm').on('click', '#submit', function (e) {
                e.preventDefault();
                var rowData = {};
                $('.dynamic').each(function () {
                    var id = $(this).attr('id');
                    var value = $(this).val();
                    rowData[id] = value;
                })
                var FirstName = $('#Firstname').val();
                rowData['Firstname'] = FirstName;
                rowData['Counter1'] = Counter1;
                allData.push(rowData)
                Counter1++;

                table();
                MyForm.reset();
                $('#Tbody').empty();
                Counter = 0;
            });


            $(document).on('click', '.delete', function (e) {
                var rowCount = $('#Tbody tr').length;
                if (rowCount > 2) {
                    if ($(this).closest('tr').is(':last-child')) {
                        $(this).closest('tr').remove(); 
                    } else {
                        alert("You can only delete the last row."); 
                        return false; 
                    }
                } else {
                    alert("You cannot delete the this row."); 
                    return false; 
                }
            });

            function table() {
                debugger
                var table = $('#SecondTable').DataTable();
                table.clear().draw();
                $.each(allData, function (index, object) {
                    var newRow = table.row.add([object.Firstname, '<input type="button" class="Edit" value="Edit"> <input type="button" class="Delete" value="Delete">']).draw().node();
                    $(newRow).attr('Counter1', object.Counter1);
                });
            }

            $(document).on('click', '.Edit', function () {
                debugger
                var RowIndexClick = parseInt($(this).closest('tr').attr('Counter1'));
                RowIndex1s = allData.findIndex(function (element) {
                    return element.Counter1 == RowIndexClick;
                });
                var rowData = allData[RowIndex1s];

                var ObjectLength = Object.keys(rowData).length;
                var ActualData = ObjectLength - 2;
                var ActualRowsNeeded = ActualData / 6;
                Counter = 0;
                for (var i = 0; i < ActualRowsNeeded; i++) {
                    var newRow = '<tr>';
                    for (var j = 0; j < 6; j++) {
                        newRow += '<td> <input type="text" class="dynamic" id="dynamic' + Counter + '">';
                        Counter++;
                    }
                    newRow += '<td><button class="delete">Delete</button></td>';
                    newRow += '</tr>';
                    $('#Tbody').append(newRow);
                }

                $('.dynamic').each(function () {
                    var id = $(this).attr('id');
                    $(this).val(rowData[id]);
                });
            });

            $(document).on('click', '#update', function () {
                debugger
                var rowData = {};
                $('.dynamic').each(function () {
                    var id = $(this).attr('id');
                    var value = $(this).val();
                    rowData[id] = value;
                });


                var originalFirstName = allData[RowIndex1s].Firstname;
                var originalCounter1 = allData[RowIndex1s].Counter1;


                rowData.Firstname = originalFirstName;
                rowData.Counter1 = originalCounter1;


                allData[RowIndex1s] = rowData;

                table();
                console.log(allData)
                $('#Tbody').empty();
            });

        });
    </script>
</body>

</html>