<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.0/css/dataTables.dataTables.css" />
    <script src="https://cdn.datatables.net/2.0.0/js/dataTables.js"></script>
</head>

<body>
    <form id="form1">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mt-4 mb-4">
                    <label for="Fruit_Name">Fruit_Name</label>
                    <input type="text" name="Fruit_Name" id="Fruit_Name" class="form-control">
                </div>

                <div class="col-lg-4 mt-4 mb-4">
                    <label for="Price">Price</label>
                    <input type="text" name="Price" id="Price" class="form-control">
                </div>

                <div class="col-lg-4 mt-4 mb-4">
                    <label for="quantity">quantity</label>
                    <input type="text" name="quantity" id="quantity" class="form-control">

                </div>

            </div>
            <input type="submit" name="submit" id="save1" class="btn-primary mt-4 mb-4 ">
            <table id="Fruit_Table" class="mt-5 mb-4">
                <thead>
                    <tr>
                        <th>Fruit_Name</th>
                        <th>Price</th>
                        <th>quantity</th>
                        <th>Sale</th>
                        <th>Total</th>
                        <th>Action</th>
                    </tr>
                </thead>
            </table>
            <h4 id="GrandTotal"></h4>
        </div>
    </form>
    <script>
        var fruitList = [];
        var counter2 = 0;
        var counter1 = 0;
        var counter3 = 0
        var table = $('#Fruit_Table').DataTable();
        $(document).ready(function () {
            $('#form1').on('click', '#save1', function (e) {
                e.preventDefault();
                var OnebyOnedataFruit = {};
                var Fruitname = $('#Fruit_Name').val();
                var Price = $('#Price').val();
                var quantity = $('#quantity').val();

                OnebyOnedataFruit['Fruitname'] = Fruitname;
                OnebyOnedataFruit['Price'] = Price
                OnebyOnedataFruit['quantity'] = quantity
                OnebyOnedataFruit['counter2'] = counter2
                OnebyOnedataFruit['Deleted'] = false;
                fruitList.push(OnebyOnedataFruit)
                counter2++;
                console.log(fruitList)
                $('#form1')[0].reset();

                table1();

            })
            function table1() {
                table.clear().draw();
                $.each(fruitList, function (index, object) {
                    if (object.Deleted == false) {
                        var row = table.row.add([object.Fruitname, object.Price, object.quantity, '<input type="number" name="sale" id="sale' + counter1 + '" class="sale" max="100" min="0">', '<input type="text" name="total" id="Total' + counter3 + '" class="Total" >', '<input type="button" class="Delete" value="Delete">']).draw().node();
                        $(row).attr('counter2', object.counter2)
                        counter1++;
                        counter3++;
                    }

                });
            }
            $('#Fruit_Table').on('keyup', '.sale', function () {
                var rowFind = $(this).closest('tr').attr('counter2');
                var FindIndex = fruitList.findIndex(function (element) {
                    return element.counter2 == rowFind;
                });

                var price = parseFloat(fruitList[FindIndex].Price);
                var saleValue = parseFloat($(this).val());
                var total = price * saleValue;

                var quantity = fruitList[FindIndex].quantity
                var rem = quantity - saleValue

                table.cell($(this).closest('tr'), 4).data(total);
                if (saleValue != null) {
                    table.cell($(this).closest('tr'), 2).data(rem);
                }
                Grand();

            });

            $('#Fruit_Table').on('click', '.Delete', function () {
                debugger
                var findIndexDelete = $(this).closest('tr').attr('counter2');
                var ObjectIndex = fruitList.findIndex(function (element) {
                    return element.counter2 == findIndexDelete;
                });
                fruitList[ObjectIndex].Deleted = true;
                table1();
                
            });

            function Grand() {
                var total =0;
                var ObjectLengh1 = fruitList.length;
                console.log(ObjectLengh1);
                for (var i = 0; i < ObjectLengh1; i++) {
                    var columnData = table.column(4).data();
                    var cellData = columnData[i];
                    total  = total+ cellData
                    debugger
                    if(total!=null)
                    {
                        $('#GrandTotal').text(total)
                    }
                  
                }

            }
        })
    </script>
</body>

</html>